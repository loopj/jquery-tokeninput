/*! jquery.tokeninput 2014-12-14 */
!function(a){function b(a){return String(null===a||void 0===a?"":a)}function c(a){return b(a).replace(i,function(a){return h[a]})}var d={token_prefix:[],method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",excludeCurrent:!1,excludeCurrentParameter:"x",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&#215;",animateDropdown:!0,placeholder:null,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(a){var b=a[this.propertyToSearch];return"<li>"+(this.enableHTML?b:c(b))+"</li>"},tokenFormatter:function(a){var b=a[this.propertyToSearch];return"<li><p>"+(this.enableHTML?b:c(b))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,autoSelectFirstResult:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},e={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},f={BEFORE:0,AFTER:1,END:2},g={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},i=/[&<>"'\/]/g,j={init:function(b,c){var e=a.extend({},d,c||{});return this.each(function(){a(this).data("settings",e),a(this).data("tokenInputObject",new a.TokenList(this,b,e))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(a){return this.data("tokenInputObject").add(a),this},remove:function(a){return this.data("tokenInputObject").remove(a),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(a){return this.data("tokenInputObject").toggleDisabled(a),this},setOptions:function(b){return a(this).data("settings",a.extend({},a(this).data("settings"),b||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var a=this,b=this.parent();return b.empty(),a.show(),b.append(a),a}}};a.fn.tokenInput=function(a){return j[a]?j[a].apply(this,Array.prototype.slice.call(arguments,1)):j.init.apply(this,arguments)},a.TokenList=function(b,d,h){function i(d){return a(b).data("settings").enableHTML?d:c(d)}function j(c){a(b).data("settings").disabled="boolean"==typeof c?c:!a(b).data("settings").disabled,U.attr("disabled",a(b).data("settings").disabled),Z.toggleClass(a(b).data("settings").classes.disabled,a(b).data("settings").disabled),W&&q(a(W),f.END),V.attr("disabled",a(b).data("settings").disabled)}function k(){return null!==a(b).data("settings").tokenLimit&&S>=a(b).data("settings").tokenLimit?(U.hide(),void u()):void 0}function l(){if(Q!==(Q=U.val())){var a=Z.width()-U.offset().left-Z.offset().left;ab.html(c(Q)||c(h.placeholder)),U.width(Math.min(Z.width(),Math.max(a,ab.width()+30)))}}function m(){var c=a.trim(U.val()),d=c.split(a(b).data("settings").tokenDelimiter);a.each(d,function(c,d){if(d){a.isFunction(a(b).data("settings").onFreeTaggingAdd)&&(d=a(b).data("settings").onFreeTaggingAdd.call(V,d));var e={};e[a(b).data("settings").tokenValue]=e[a(b).data("settings").propertyToSearch]=d,o(e)}})}function n(c){var d=a(a(b).data("settings").tokenFormatter(c)),e=c.readonly===!0;e&&d.addClass(a(b).data("settings").classes.tokenReadOnly),d.addClass(a(b).data("settings").classes.token).insertBefore($),e||a("<span>"+a(b).data("settings").deleteText+"</span>").addClass(a(b).data("settings").classes.tokenDelete).appendTo(d).click(function(){return a(b).data("settings").disabled?void 0:(s(a(this).parent()),V.change(),!1)});var f=c;return a.data(d.get(0),"tokeninput",c),R=R.slice(0,X).concat([f]).concat(R.slice(X)),X++,t(R,V),S+=1,null!==a(b).data("settings").tokenLimit&&S>=a(b).data("settings").tokenLimit&&(U.hide(),u()),d}function o(c){var d=a(b).data("settings").onAdd;if(S>0&&a(b).data("settings").preventDuplicates){var e=null;if(Z.children().each(function(){var b=a(this),d=a.data(b.get(0),"tokeninput");return d&&d[h.tokenValue]===c[h.tokenValue]?(e=b,!1):void 0}),e)return p(e),$.insertAfter(e),void I(U)}U.width(1),(null==a(b).data("settings").tokenLimit||S<a(b).data("settings").tokenLimit)&&(n(c),U.attr("placeholder",null),k()),U.val(""),u(),a.isFunction(d)&&d.call(V,c)}function p(c){a(b).data("settings").disabled||(c.addClass(a(b).data("settings").classes.selectedToken),W=c.get(0),U.val(""),u())}function q(c,d){c.removeClass(a(b).data("settings").classes.selectedToken),W=null,d===f.BEFORE?($.insertBefore(c),X--):d===f.AFTER?($.insertAfter(c),X++):($.appendTo(Z),X=S),I(U)}function r(b){var c=W;W&&q(a(W),f.END),c===b.get(0)?q(b,f.END):p(b)}function s(c){var d=a.data(c.get(0),"tokeninput"),e=a(b).data("settings").onDelete,f=c.prevAll().length;f>X&&f--,c.remove(),W=null,I(U),R=R.slice(0,f).concat(R.slice(f+1)),0==R.length&&U.attr("placeholder",h.placeholder),X>f&&X--,t(R,V),S-=1,null!==a(b).data("settings").tokenLimit&&(U.show().val(""),I(U)),a.isFunction(e)&&e.call(V,d)}function t(c,d){var e=a.map(c,function(c){return"function"==typeof a(b).data("settings").tokenValue?a(b).data("settings").tokenValue.call(this,c):c[a(b).data("settings").tokenValue]});d.val(e.join(a(b).data("settings").tokenDelimiter))}function u(){_.hide().empty(),Y=null}function v(){_.css({position:"absolute",top:Z.offset().top+Z.outerHeight(!0),left:Z.offset().left,width:Z.width(),"z-index":a(b).data("settings").zindex}).show()}function w(){a(b).data("settings").searchingText&&(_.html("<p>"+i(a(b).data("settings").searchingText)+"</p>"),v())}function x(){a(b).data("settings").hintText&&(_.html("<p>"+i(a(b).data("settings").hintText)+"</p>"),v())}function y(a){return a.replace(cb,"\\$&")}function z(a,b){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+y(b)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(a,b){return"<b>"+i(b)+"</b>"})}function A(a,b,c){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+y(b)+")(?![^<>]*>)(?![^&;]+;)","g"),z(b,c))}function B(c){if(a(b).data("settings").excludeCurrent){var d=a(b).data("tokenInputObject").getTokens(),e=[];d.length&&(a.each(c,function(c,f){var g=!0;a.each(d,function(c,d){return f[a(b).data("settings").propertyToSearch]==d[a(b).data("settings").propertyToSearch]?(g=!1,!1):void 0}),g&&e.push(f)}),c=e)}return c}function C(c,d){if(d=B(d),d&&d.length){_.empty();var e=a("<ul/>").appendTo(_).mouseover(function(b){D(a(b.target).closest("li"))}).mousedown(function(b){return o(a(b.target).closest("li").data("tokeninput")),V.change(),!1}).hide();a(b).data("settings").resultsLimit&&d.length>a(b).data("settings").resultsLimit&&(d=d.slice(0,a(b).data("settings").resultsLimit)),a.each(d,function(d,f){var g=a(b).data("settings").resultsFormatter(f);g=A(g,f[a(b).data("settings").propertyToSearch],c),g=a(g).appendTo(e),g.addClass(d%2?a(b).data("settings").classes.dropdownItem:a(b).data("settings").classes.dropdownItem2),0===d&&a(b).data("settings").autoSelectFirstResult&&D(g),a.data(g.get(0),"tokeninput",f)}),v(),a(b).data("settings").animateDropdown?e.slideDown("fast"):e.show()}else a(b).data("settings").noResultsText&&(_.html("<p>"+i(a(b).data("settings").noResultsText)+"</p>"),v())}function D(c){c&&(Y&&E(a(Y)),c.addClass(a(b).data("settings").classes.selectedDropdownItem),Y=c.get(0))}function E(c){c.removeClass(a(b).data("settings").classes.selectedDropdownItem),Y=null}function F(){var c=U.val();c&&c.length&&(W&&q(a(W),f.AFTER),c.length>=a(b).data("settings").minChars?(w(),clearTimeout(P),P=setTimeout(function(){G(c)},a(b).data("settings").searchDelay)):u())}function G(c){var e=c+H(),f=T.get(e);if(f)a.isFunction(a(b).data("settings").onCachedResult)&&(f=a(b).data("settings").onCachedResult.call(V,f)),C(c,f);else if(a(b).data("settings").url){var g=H(),i={};if(i.data={},g.indexOf("?")>-1){var j=g.split("?");i.url=j[0];var k=j[1].split("&");a.each(k,function(a,b){var c=b.split("=");i.data[c[0]]=c[1]})}else i.url=g;if(i.data[a(b).data("settings").queryParam]=c,i.type=a(b).data("settings").method,i.dataType=a(b).data("settings").contentType,a(b).data("settings").crossDomain&&(i.dataType="jsonp"),a(b).data("settings").excludeCurrent){var l=a(b).data("tokenInputObject").getTokens(),m=a.map(l,function(c){return"function"==typeof a(b).data("settings").tokenValue?a(b).data("settings").tokenValue.call(this,c):c[a(b).data("settings").tokenValue]});i.data[a(b).data("settings").excludeCurrentParameter]=m.join(a(b).data("settings").tokenDelimiter)}i.success=function(d){T.add(e,a(b).data("settings").jsonContainer?d[a(b).data("settings").jsonContainer]:d),a.isFunction(a(b).data("settings").onResult)&&(d=a(b).data("settings").onResult.call(V,d)),U.val()===c&&C(c,a(b).data("settings").jsonContainer?d[a(b).data("settings").jsonContainer]:d)},h.onSend&&h.onSend(i),a.ajax(i)}else if(a(b).data("settings").local_data){var n=a.grep(a(b).data("settings").local_data,function(d){return d[a(b).data("settings").propertyToSearch].toLowerCase().indexOf(c.toLowerCase())>-1});T.add(e,n),a.isFunction(a(b).data("settings").onResult)&&(n=a(b).data("settings").onResult.call(V,n)),C(c,n)}else if(a(b).data("settings").prefix){var g=d[arguments[1]],i={};if(i.data={},g.indexOf("?")>-1){var j=g.split("?");i.url=j[0];var k=j[1].split("&");a.each(k,function(a,b){var c=b.split("=");i.data[c[0]]=c[1]})}else i.url=g;if(i.data[a(b).data("settings").queryParam]=c,i.type=a(b).data("settings").method,i.dataType=a(b).data("settings").contentType,a(b).data("settings").crossDomain&&(i.dataType="jsonp"),a(b).data("settings").excludeCurrent){var l=a(b).data("tokenInputObject").getTokens(),m=a.map(l,function(c){return"function"==typeof a(b).data("settings").tokenValue?a(b).data("settings").tokenValue.call(this,c):c[a(b).data("settings").tokenValue]});i.data[a(b).data("settings").excludeCurrentParameter]=m.join(a(b).data("settings").tokenDelimiter)}i.success=function(d){T.add(e,a(b).data("settings").jsonContainer?d[a(b).data("settings").jsonContainer]:d),a.isFunction(a(b).data("settings").onResult)&&(d=a(b).data("settings").onResult.call(V,d)),U.val()===c&&C(c,a(b).data("settings").jsonContainer?d[a(b).data("settings").jsonContainer]:d)},h.onSend&&h.onSend(i),a.ajax(i)}}function H(){var c=a(b).data("settings").url;return"function"==typeof a(b).data("settings").url&&(c=a(b).data("settings").url.call(a(b).data("settings"))),c}function I(a){setTimeout(function(){a.focus()},50)}function J(c){a.inArray(c,a(b).data("settings").token_prefix)>=0&&setTimeout(function(){K(c)},5)}function K(c){var d=U.val().substring(1);d&&d.length&&(W&&q(a(W),f.AFTER),d.length>=a(b).data("settings").minChars?(w(),clearTimeout(P),P=setTimeout(function(){G(d,c)},a(b).data("settings").searchDelay)):u())}if("string"==typeof d||"function"==typeof d){a(b).data("settings").url=d;var L=H();void 0===a(b).data("settings").crossDomain&&"string"==typeof L&&(a(b).data("settings").crossDomain=-1===L.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==L.split(/\/+/g)[1])}else if("object"==typeof d)if(d.prefix===!0){a(b).data("settings").prefix=!0;var M=Object.keys(d);for(var N in M){var O=M[N];"string"==typeof d[O]&&a(b).data("settings").token_prefix.push(O)}}else a(b).data("settings").local_data=d;a(b).data("settings").classes?a(b).data("settings").classes=a.extend({},e,a(b).data("settings").classes):a(b).data("settings").theme?(a(b).data("settings").classes={},a.each(e,function(c,d){a(b).data("settings").classes[c]=d+"-"+a(b).data("settings").theme})):a(b).data("settings").classes=e;var P,Q,R=[],S=0,T=new a.TokenList.Cache,U=a('<input type="text" autocomplete="off" autocapitalize="off"/>').css({outline:"none"}).attr("id",a(b).data("settings").idPrefix+b.id).focus(function(){return a(b).data("settings").disabled?!1:((null===a(b).data("settings").tokenLimit||a(b).data("settings").tokenLimit!==S)&&x(),void Z.addClass(a(b).data("settings").classes.focused))}).blur(function(){u(),a(b).data("settings").allowFreeTagging&&m(),a(this).val(""),Z.removeClass(a(b).data("settings").classes.focused)}).bind("keyup keydown blur update",l).keydown(function(c){var d,e;switch(c.keyCode){case g.LEFT:case g.RIGHT:case g.UP:case g.DOWN:if(0===this.value.length)d=$.prev(),e=$.next(),d.length&&d.get(0)===W||e.length&&e.get(0)===W?c.keyCode===g.LEFT||c.keyCode===g.UP?q(a(W),f.BEFORE):q(a(W),f.AFTER):c.keyCode!==g.LEFT&&c.keyCode!==g.UP||!d.length?c.keyCode!==g.RIGHT&&c.keyCode!==g.DOWN||!e.length||p(a(e.get(0))):p(a(d.get(0)));else{var h=null;c.keyCode===g.DOWN||c.keyCode===g.RIGHT?(h=a(_).find("li").first(),Y&&(h=a(Y).next())):(h=a(_).find("li").last(),Y&&(h=a(Y).prev())),D(h)}break;case g.BACKSPACE:if(d=$.prev(),0===this.value.length)return W?(s(a(W)),V.change()):d.length&&p(a(d.get(0))),!1;1===a(this).val().length?u():a(b).data("settings").prefix===!0?(console.log(a(this).val().charAt(0)),a.inArray(a(this).val().charAt(0),a(b).data("settings").token_prefix)&&console.log("in prefix")):setTimeout(function(){F()},5);break;case g.TAB:case g.ENTER:case g.NUMPAD_ENTER:case g.COMMA:if(Y)o(a(Y).data("tokeninput")),V.change();else{if(a(b).data("settings").allowFreeTagging){if(a(b).data("settings").allowTabOut&&""===a(this).val())return!0;m()}else if(a(this).val(""),a(b).data("settings").allowTabOut)return!0;c.stopPropagation(),c.preventDefault()}return!1;case g.ESCAPE:return u(),!0;default:String.fromCharCode(c.which)&&(a(b).data("settings").prefix===!0?J(a(this).val().charAt(0)):setTimeout(function(){F()},5))}});h.placeholder&&U.attr("placeholder",h.placeholder);var V=a(b).hide().val("").focus(function(){I(U)}).blur(function(){return U.blur(),V}),W=null,X=0,Y=null,Z=a("<ul />").addClass(a(b).data("settings").classes.tokenList).click(function(b){var c=a(b.target).closest("li");c&&c.get(0)&&a.data(c.get(0),"tokeninput")?r(c):(W&&q(a(W),f.END),I(U))}).mouseover(function(c){var d=a(c.target).closest("li");d&&W!==this&&d.addClass(a(b).data("settings").classes.highlightedToken)}).mouseout(function(c){var d=a(c.target).closest("li");d&&W!==this&&d.removeClass(a(b).data("settings").classes.highlightedToken)}).insertBefore(V),$=a("<li />").addClass(a(b).data("settings").classes.inputToken).appendTo(Z).append(U),_=a("<div/>").addClass(a(b).data("settings").classes.dropdown).appendTo("body").hide(),ab=a("<tester/>").insertAfter(U).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:U.css("fontSize"),fontFamily:U.css("fontFamily"),fontWeight:U.css("fontWeight"),letterSpacing:U.css("letterSpacing"),whiteSpace:"nowrap"});V.val("");var bb=a(b).data("settings").prePopulate||V.data("pre");a(b).data("settings").processPrePopulate&&a.isFunction(a(b).data("settings").onResult)&&(bb=a(b).data("settings").onResult.call(V,bb)),bb&&bb.length&&a.each(bb,function(a,b){n(b),k(),U.attr("placeholder",null)}),a(b).data("settings").disabled&&j(!0),"function"==typeof a(b).data("settings").onReady&&a(b).data("settings").onReady.call(),this.clear=function(){Z.children("li").each(function(){0===a(this).children("input").length&&s(a(this))})},this.add=function(a){o(a)},this.remove=function(b){Z.children("li").each(function(){if(0===a(this).children("input").length){var c=a(this).data("tokeninput"),d=!0;for(var e in b)if(b[e]!==c[e]){d=!1;break}d&&s(a(this))}})},this.getTokens=function(){return R},this.toggleDisabled=function(a){j(a)},l();var cb=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},a.TokenList.Cache=function(b){var c,d,e={},f=0;c=a.extend({max_size:500},b),d=function(){e={},f=0},this.add=function(a,b){f>c.max_size&&d(),e[a]||(f+=1),e[a]=b},this.get=function(a){return e[a]}}}(jQuery);