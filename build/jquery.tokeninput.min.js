!function(t){function e(t){return String(null===t||void 0===t?"":t)}function n(t){return e(t).replace(d,function(t){return l[t]})}var a={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",excludeCurrent:!1,excludeCurrentParameter:"x",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&#215;",animateDropdown:!0,placeholder:null,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(t){var e=t[this.propertyToSearch];return"<li>"+(this.enableHTML?e:n(e))+"</li>"},tokenFormatter:function(t){var e=t[this.propertyToSearch];return"<li><p>"+(this.enableHTML?e:n(e))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,autoSelectFirstResult:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},s={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},i={BEFORE:0,AFTER:1,END:2},o={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},l={"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},d=/[&<>"'\/]/g,r={init:function(e,n){var s=t.extend({},a,n||{});return this.each(function(){t(this).data("settings",s),t(this).data("tokenInputObject",new t.TokenList(this,e,s))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(t){return this.data("tokenInputObject").add(t),this},remove:function(t){return this.data("tokenInputObject").remove(t),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(t){return this.data("tokenInputObject").toggleDisabled(t),this},setOptions:function(e){return t(this).data("settings",t.extend({},t(this).data("settings"),e||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var t=this,e=this.parent();return e.empty(),t.show(),e.append(t),t}}};t.fn.tokenInput=function(t){return r[t]?r[t].apply(this,Array.prototype.slice.call(arguments,1)):r.init.apply(this,arguments)},t.TokenList=function(e,a,l){function d(a){return t(e).data("settings").enableHTML?a:n(a)}function r(n){t(e).data("settings").disabled="boolean"==typeof n?n:!t(e).data("settings").disabled,z.attr("disabled",t(e).data("settings").disabled),q.toggleClass(t(e).data("settings").classes.disabled,t(e).data("settings").disabled),G&&k(t(G),i.END),V.attr("disabled",t(e).data("settings").disabled)}function u(){return null!==t(e).data("settings").tokenLimit&&H>=t(e).data("settings").tokenLimit?(z.hide(),void y()):void 0}function c(){if(M!==(M=z.val())){var t=q.width()-z.offset().left-q.offset().left;Q.html(n(M)||n(l.placeholder)),z.width(Math.min(q.width(),Math.max(t,Q.width()+30)))}}function g(){var n=t.trim(z.val()),a=n.split(t(e).data("settings").tokenDelimiter);t.each(a,function(n,a){if(a){t.isFunction(t(e).data("settings").onFreeTaggingAdd)&&(a=t(e).data("settings").onFreeTaggingAdd.call(V,a));var s={};s[t(e).data("settings").tokenValue]=s[t(e).data("settings").propertyToSearch]=a,h(s)}})}function p(n){var a=t(t(e).data("settings").tokenFormatter(n)),s=n.readonly===!0;s&&a.addClass(t(e).data("settings").classes.tokenReadOnly),a.addClass(t(e).data("settings").classes.token).insertBefore(K),s||t("<span>"+t(e).data("settings").deleteText+"</span>").addClass(t(e).data("settings").classes.tokenDelete).appendTo(a).click(function(){return t(e).data("settings").disabled?void 0:(v(t(this).parent()),V.change(),!1)});var i=n;return t.data(a.get(0),"tokeninput",n),B=B.slice(0,U).concat([i]).concat(B.slice(U)),U++,T(B,V),H+=1,null!==t(e).data("settings").tokenLimit&&H>=t(e).data("settings").tokenLimit&&(z.hide(),y()),a}function h(e){var n=l.onAdd;if(H>0&&l.preventDuplicates){var a=null;if(q.children().each(function(){var n=t(this),s=t.data(n.get(0),"tokeninput");return s&&s.id===e.id?(a=n,!1):void 0}),a)return f(a),K.insertAfter(a),void z.focus()}(null==l.tokenLimit||H<l.tokenLimit)&&(p(e),u()),z.val(""),y(),t.isFunction(n)&&n.call(V,e)}function f(n){t(e).data("settings").disabled||(n.addClass(t(e).data("settings").classes.selectedToken),G=n.get(0),z.val(""),y())}function k(n,a){n.removeClass(t(e).data("settings").classes.selectedToken),G=null,a===i.BEFORE?(K.insertBefore(n),U--):a===i.AFTER?(K.insertAfter(n),U++):(K.appendTo(q),U=H),j(z)}function m(e){var n=G;G&&k(t(G),i.END),n===e.get(0)?k(e,i.END):f(e)}function v(n){var a=t.data(n.get(0),"tokeninput"),s=t(e).data("settings").onDelete,i=n.prevAll().length;i>U&&i--,n.remove(),G=null,j(z),B=B.slice(0,i).concat(B.slice(i+1)),0==B.length&&z.attr("placeholder",l.placeholder),U>i&&U--,T(B,V),H-=1,null!==t(e).data("settings").tokenLimit&&(z.show().val(""),j(z)),t.isFunction(s)&&s.call(V,a)}function T(n,a){var s=t.map(n,function(n){return"function"==typeof t(e).data("settings").tokenValue?t(e).data("settings").tokenValue.call(this,n):n[t(e).data("settings").tokenValue]});a.val(s.join(t(e).data("settings").tokenDelimiter))}function y(){$.hide().empty(),W=null}function C(){$.css({position:"absolute",top:q.offset().top+q.outerHeight(!0),left:q.offset().left,width:q.width(),"z-index":t(e).data("settings").zindex}).show()}function b(){t(e).data("settings").searchingText&&($.html("<p>"+d(t(e).data("settings").searchingText)+"</p>"),C())}function w(){t(e).data("settings").hintText&&($.html("<p>"+d(t(e).data("settings").hintText)+"</p>"),C())}function E(t){return t.replace(X,"\\$&")}function x(t,e){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(e)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(t,e){return"<b>"+d(e)+"</b>"})}function D(t,e,n){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(e)+")(?![^<>]*>)(?![^&;]+;)","g"),x(e,n))}function R(n){if(t(e).data("settings").excludeCurrent){var a=t(e).data("tokenInputObject").getTokens(),s=[];a.length&&(t.each(n,function(n,i){var o=!0;t.each(a,function(n,a){return i[t(e).data("settings").propertyToSearch]==a[t(e).data("settings").propertyToSearch]?(o=!1,!1):void 0}),o&&s.push(i)}),n=s)}return n}function F(n,a){if(a=R(a),a&&a.length){$.empty();var s=t("<ul/>").appendTo($).mouseover(function(e){L(t(e.target).closest("li"))}).mousedown(function(e){return h(t(e.target).closest("li").data("tokeninput")),V.change(),!1}).hide();t(e).data("settings").resultsLimit&&a.length>t(e).data("settings").resultsLimit&&(a=a.slice(0,t(e).data("settings").resultsLimit)),t.each(a,function(a,i){var o=t(e).data("settings").resultsFormatter(i);o=D(o,i[t(e).data("settings").propertyToSearch],n),o=t(o).appendTo(s),o.addClass(a%2?t(e).data("settings").classes.dropdownItem:t(e).data("settings").classes.dropdownItem2),0===a&&t(e).data("settings").autoSelectFirstResult&&L(o),t.data(o.get(0),"tokeninput",i)}),C(),t(e).data("settings").animateDropdown?s.slideDown("fast"):s.show()}else t(e).data("settings").noResultsText&&($.html("<p>"+d(t(e).data("settings").noResultsText)+"</p>"),C())}function L(n){n&&(W&&O(t(W)),n.addClass(t(e).data("settings").classes.selectedDropdownItem),W=n.get(0))}function O(n){n.removeClass(t(e).data("settings").classes.selectedDropdownItem),W=null}function A(){var n=z.val();n&&n.length&&(G&&k(t(G),i.AFTER),n.length>=t(e).data("settings").minChars?(b(),clearTimeout(N),N=setTimeout(function(){P(n)},t(e).data("settings").searchDelay)):y())}function P(n){var a=n+S(),s=_.get(a);if(s)t.isFunction(t(e).data("settings").onCachedResult)&&(s=t(e).data("settings").onCachedResult.call(V,s)),F(n,s);else if(t(e).data("settings").url){var i=S(),o={};if(o.data={},i.indexOf("?")>-1){var d=i.split("?");o.url=d[0];var r=d[1].split("&");t.each(r,function(t,e){var n=e.split("=");o.data[n[0]]=n[1]})}else o.url=i;if(o.data[t(e).data("settings").queryParam]=n,o.type=t(e).data("settings").method,o.dataType=t(e).data("settings").contentType,t(e).data("settings").crossDomain&&(o.dataType="jsonp"),t(e).data("settings").excludeCurrent){var u=t(e).data("tokenInputObject").getTokens(),c=t.map(u,function(n){return"function"==typeof t(e).data("settings").tokenValue?t(e).data("settings").tokenValue.call(this,n):n[t(e).data("settings").tokenValue]});o.data[t(e).data("settings").excludeCurrentParameter]=c.join(t(e).data("settings").tokenDelimiter)}o.success=function(s){_.add(a,t(e).data("settings").jsonContainer?s[t(e).data("settings").jsonContainer]:s),t.isFunction(t(e).data("settings").onResult)&&(s=t(e).data("settings").onResult.call(V,s)),z.val()===n&&F(n,t(e).data("settings").jsonContainer?s[t(e).data("settings").jsonContainer]:s)},l.onSend&&l.onSend(o),t.ajax(o)}else if(t(e).data("settings").local_data){var g=t.grep(t(e).data("settings").local_data,function(a){return a[t(e).data("settings").propertyToSearch].toLowerCase().indexOf(n.toLowerCase())>-1});_.add(a,g),t.isFunction(t(e).data("settings").onResult)&&(g=t(e).data("settings").onResult.call(V,g)),F(n,g)}}function S(){var n=t(e).data("settings");return"function"==typeof n.url?n.url.call(n):n.url}function j(t){setTimeout(function(){t.focus()},50)}if("string"==typeof a||"function"==typeof a){t(e).data("settings").url=a;var I=S();void 0===t(e).data("settings").crossDomain&&"string"==typeof I&&(t(e).data("settings").crossDomain=-1===I.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==I.split(/\/+/g)[1])}else"object"==typeof a&&(t(e).data("settings").local_data=a);t(e).data("settings").classes?t(e).data("settings").classes=t.extend({},s,t(e).data("settings").classes):t(e).data("settings").theme?(t(e).data("settings").classes={},t.each(s,function(n,a){t(e).data("settings").classes[n]=a+"-"+t(e).data("settings").theme})):t(e).data("settings").classes=s;var N,M,B=[],H=0,_=new t.TokenList.Cache,z=t('<input type="text" autocomplete="off" autocapitalize="off"/>').css({outline:"none"}).attr("id",t(e).data("settings").idPrefix+e.id).focus(function(){return t(e).data("settings").disabled?!1:((null===t(e).data("settings").tokenLimit||t(e).data("settings").tokenLimit!==H)&&w(),void q.addClass(t(e).data("settings").classes.focused))}).blur(function(){y(),t(e).data("settings").allowFreeTagging&&g(),t(this).val(""),q.removeClass(t(e).data("settings").classes.focused)}).bind("keyup keydown blur update",c).keydown(function(n){var a,s;switch(n.keyCode){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:if(0===this.value.length)a=K.prev(),s=K.next(),a.length&&a.get(0)===G||s.length&&s.get(0)===G?n.keyCode===o.LEFT||n.keyCode===o.UP?k(t(G),i.BEFORE):k(t(G),i.AFTER):n.keyCode!==o.LEFT&&n.keyCode!==o.UP||!a.length?n.keyCode!==o.RIGHT&&n.keyCode!==o.DOWN||!s.length||f(t(s.get(0))):f(t(a.get(0)));else{var l=null;n.keyCode===o.DOWN||n.keyCode===o.RIGHT?(l=t($).find("li").first(),W&&(l=t(W).next())):(l=t($).find("li").last(),W&&(l=t(W).prev())),L(l)}break;case o.BACKSPACE:if(a=K.prev(),0===this.value.length)return G?(v(t(G)),V.change()):a.length&&f(t(a.get(0))),!1;1===t(this).val().length?y():setTimeout(function(){A()},5);break;case o.TAB:case o.ENTER:case o.NUMPAD_ENTER:case o.COMMA:if(W)h(t(W).data("tokeninput")),V.change();else{if(t(e).data("settings").allowFreeTagging){if(t(e).data("settings").allowTabOut&&""===t(this).val())return!0;g()}else if(t(this).val(""),t(e).data("settings").allowTabOut)return!0;n.stopPropagation(),n.preventDefault()}return!1;case o.ESCAPE:return y(),!0;default:String.fromCharCode(n.which)&&setTimeout(function(){A()},5)}});l.placeholder&&z.attr("placeholder",l.placeholder);var V=t(e).hide().val("").focus(function(){j(z)}).blur(function(){return z.blur(),V}),G=null,U=0,W=null,q=t("<ul />").addClass(t(e).data("settings").classes.tokenList).click(function(e){var n=t(e.target).closest("li");n&&n.get(0)&&t.data(n.get(0),"tokeninput")?m(n):(G&&k(t(G),i.END),j(z))}).mouseover(function(n){var a=t(n.target).closest("li");a&&G!==this&&a.addClass(t(e).data("settings").classes.highlightedToken)}).mouseout(function(n){var a=t(n.target).closest("li");a&&G!==this&&a.removeClass(t(e).data("settings").classes.highlightedToken)}).insertBefore(V),K=t("<li />").addClass(t(e).data("settings").classes.inputToken).appendTo(q).append(z),$=t("<div/>").addClass(t(e).data("settings").classes.dropdown).appendTo("body").hide(),Q=t("<tester/>").insertAfter(z).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:z.css("fontSize"),fontFamily:z.css("fontFamily"),fontWeight:z.css("fontWeight"),letterSpacing:z.css("letterSpacing"),whiteSpace:"nowrap"});V.val("");var J=t(e).data("settings").prePopulate||V.data("pre");t(e).data("settings").processPrePopulate&&t.isFunction(t(e).data("settings").onResult)&&(J=t(e).data("settings").onResult.call(V,J)),J&&J.length&&t.each(J,function(t,e){p(e),u(),z.attr("placeholder",null)}),t(e).data("settings").disabled&&r(!0),"function"==typeof t(e).data("settings").onReady&&t(e).data("settings").onReady.call(),this.clear=function(){q.children("li").each(function(){0===t(this).children("input").length&&v(t(this))})},this.add=function(t){h(t)},this.remove=function(e){q.children("li").each(function(){if(0===t(this).children("input").length){var n=t(this).data("tokeninput"),a=!0;for(var s in e)if(e[s]!==n[s]){a=!1;break}a&&v(t(this))}})},this.getTokens=function(){return B},this.toggleDisabled=function(t){r(t)},c();var X=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},t.TokenList.Cache=function(e){var n,a,s={},i=0;n=t.extend({max_size:500},e),a=function(){s={},i=0},this.add=function(t,e){i>n.max_size&&a(),s[t]||(i+=1),s[t]=e},this.get=function(t){return s[t]}}}(jQuery);